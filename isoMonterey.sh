#!/usr/bin/env bash

# readme
# 
# まず、macOSをダウンロードする
# https://support.apple.com/ja-jp/HT211683
# ダウンロード後、本スクリプトを実行

SLEEP () {
    sleep 3
}

echo "================================================================================================================================="
echo "=====   初期化   ================================================================================================================="
# echo "================================================================================================================================="
rm -fv /tmp/monterey.dmg ~/Desktop/monterey.iso
hdiutil eject -force /Volumes/monterey
hdiutil eject -force /Volumes/Install\ macOS\ Monterey
SLEEP
echo "================================================================================================================================="

echo "================================================================================================================================="
echo "=====   hdiutil create -o /tmp/monterey -size 16384m -volname monterey -layout SPUD -fs HFS+J   ================================="
# echo "================================================================================================================================="
hdiutil create -o /tmp/monterey -size 16384m -volname monterey -layout SPUD -fs HFS+J
SLEEP
echo "================================================================================================================================="

echo "================================================================================================================================="
echo "=====   hdiutil attach /tmp/monterey.dmg -noverify -mountpoint /Volumes/monterey   =============================================="
# echo "================================================================================================================================="
hdiutil attach /tmp/monterey.dmg -noverify -mountpoint /Volumes/monterey
SLEEP
echo "================================================================================================================================="

echo "================================================================================================================================="
echo "=====   sudo /Applications/Install\ macOS\ Monterey\.app/Contents/Resources/createinstallmedia --volume /Volumes/monterey --nointeraction ==="
# echo "================================================================================================================================="
sudo /Applications/Install\ macOS\ Monterey\.app/Contents/Resources/createinstallmedia --volume /Volumes/monterey --nointeraction
SLEEP
echo "================================================================================================================================="

echo "================================================================================================================================="
echo "=====   hdiutil eject -force /Volumes/Install\ macOS\ Monterey   ================================================================"
# echo "================================================================================================================================="
hdiutil eject -force /Volumes/Install\ macOS\ Monterey
SLEEP
echo "================================================================================================================================="

echo "================================================================================================================================="
echo "=====   hdiutil convert /tmp/monterey.dmg -format UDTO -o ~/Desktop/monterey.cdr   =============================================="
# echo "================================================================================================================================="
hdiutil convert /tmp/monterey.dmg -format UDTO -o ~/Desktop/monterey.cdr
SLEEP
echo "================================================================================================================================="

echo "================================================================================================================================="
echo "=====   mv ~/Desktop/monterey.cdr ~/Desktop/monterey.iso   ======================================================================"
# echo "================================================================================================================================="
mv ~/Desktop/monterey.cdr ~/Desktop/monterey.iso
SLEEP
echo "================================================================================================================================="
